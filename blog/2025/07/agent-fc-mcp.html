<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/angry_bird_32.ico?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/angry_bird_32.ico?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/angry_bird_16.ico?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">
  <meta name="google-site-verification" content="3dBwV8OlVnNtYzxCLCFp2w8WMpuSecV7vBmA_zrf9j4">
  <meta name="baidu-site-verification" content="eoUZD1BDx6">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":"default"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="最近遇到了几个大模型模型算法应用的关键问题，作为记录。 Agent 设计范式目前主流的AI Agent（智能体）设计模式，通常不是单一的，而是基于一些核心思想和框架的组合。这些设计模式旨在赋予大语言模型自主思考、规划、行动和反思的能力，以完成更复杂的任务。 1. ReAct (Reasoning and Acting)这是目前最流行、最基础也是最核心的一种Agent设计模式。它的核心思想是让大语言">
<meta name="keywords" content="LLM,agent,rag,mcp">
<meta property="og:type" content="article">
<meta property="og:title" content="Agent 几个问题思考">
<meta property="og:url" content="https://murphypei.github.io/blog/2025/07/agent-fc-mcp.html">
<meta property="og:site_name" content="拾荒志">
<meta property="og:description" content="最近遇到了几个大模型模型算法应用的关键问题，作为记录。 Agent 设计范式目前主流的AI Agent（智能体）设计模式，通常不是单一的，而是基于一些核心思想和框架的组合。这些设计模式旨在赋予大语言模型自主思考、规划、行动和反思的能力，以完成更复杂的任务。 1. ReAct (Reasoning and Acting)这是目前最流行、最基础也是最核心的一种Agent设计模式。它的核心思想是让大语言">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://murphypei.github.io/images/posts/llm/agent/fc_mcp.gif">
<meta property="og:updated_time" content="2025-08-29T01:33:04.202Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Agent 几个问题思考">
<meta name="twitter:description" content="最近遇到了几个大模型模型算法应用的关键问题，作为记录。 Agent 设计范式目前主流的AI Agent（智能体）设计模式，通常不是单一的，而是基于一些核心思想和框架的组合。这些设计模式旨在赋予大语言模型自主思考、规划、行动和反思的能力，以完成更复杂的任务。 1. ReAct (Reasoning and Acting)这是目前最流行、最基础也是最核心的一种Agent设计模式。它的核心思想是让大语言">
<meta name="twitter:image" content="https://murphypei.github.io/images/posts/llm/agent/fc_mcp.gif">
  <link rel="alternate" href="/atom.xml" title="拾荒志" type="application/atom+xml">
  <link rel="canonical" href="https://murphypei.github.io/blog/2025/07/agent-fc-mcp">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Agent 几个问题思考 | 拾荒志</title>
  <meta name="generator" content="Hexo 3.9.0">
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">拾荒志</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">虚怀若谷，大智若愚</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="https://murphypei.github.io/blog/2025/07/agent-fc-mcp.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AngryBirds">
      <meta itemprop="description" content="虚怀若谷，大智若愚">
      <meta itemprop="image" content="/images/angry_bird_128.ico">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="拾荒志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">Agent 几个问题思考

          
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2025-07-29 03:35:25" itemprop="dateCreated datePublished" datetime="2025-07-29T03:35:25+08:00">2025-07-29</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-08-29 09:33:04" itemprop="dateModified" datetime="2025-08-29T09:33:04+08:00">2025-08-29</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>5.7k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>10 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>最近遇到了几个大模型模型算法应用的关键问题，作为记录。</p>
<h3 id="Agent-设计范式"><a href="#Agent-设计范式" class="headerlink" title="Agent 设计范式"></a>Agent 设计范式</h3><p>目前主流的AI Agent（智能体）设计模式，通常不是单一的，而是基于一些核心思想和框架的组合。这些设计模式旨在赋予大语言模型<strong>自主思考、规划、行动和反思</strong>的能力，以完成更复杂的任务。</p>
<h4 id="1-ReAct-Reasoning-and-Acting"><a href="#1-ReAct-Reasoning-and-Acting" class="headerlink" title="1. ReAct (Reasoning and Acting)"></a>1. ReAct (Reasoning and Acting)</h4><p>这是目前最流行、最基础也是最核心的一种Agent设计模式。它的核心思想是让大语言模型在一个<strong>“思考-行动-观察”</strong>的循环中持续工作，直到任务完成。</p>
<ul>
<li><strong>思考（Thought）</strong>：LLM 会根据当前任务和过往观察，产生一段内部思考，比如“我需要找到XX信息，我应该使用什么工具？”</li>
<li><strong>行动（Action）</strong>：LLM 根据思考，生成一个调用外部工具的指令（即 Function Call）。</li>
<li><strong>观察（Observation）</strong>：LLM 接收到外部工具返回的结果。</li>
</ul>
<p>这个循环会反复进行，直到LLM判断任务已完成并生成最终回复。这种模式将“思考”过程显性化，使得模型的决策过程更加透明和可控。</p>
<h4 id="2-Plan-and-Execute（规划与执行）"><a href="#2-Plan-and-Execute（规划与执行）" class="headerlink" title="2. Plan-and-Execute（规划与执行）"></a>2. Plan-and-Execute（规划与执行）</h4><p>这种模式更侧重于对复杂任务的<strong>结构化分解</strong>。它将一个大任务分为两个阶段：</p>
<ul>
<li><strong>规划阶段（Planning）</strong>：LLM 首先会分析用户的请求，并生成一个详细的、分步骤的行动计划。这个计划是固定的，不会在执行过程中轻易改变。</li>
<li><strong>执行阶段（Execution）</strong>：LLM 严格按照规划好的步骤，一步一步地调用工具和执行任务。</li>
</ul>
<p>这种模式的优点是任务流程清晰、稳定，适合需要按部就班完成的复杂任务。但缺点是缺乏灵活性，如果计划中的某个步骤失败，Agent可能无法自主调整。</p>
<h4 id="3-Self-Correction（自我纠正-反思）"><a href="#3-Self-Correction（自我纠正-反思）" class="headerlink" title="3. Self-Correction（自我纠正/反思）"></a>3. Self-Correction（自我纠正/反思）</h4><p>这种设计模式的核心是让Agent具备<strong>复盘和纠错</strong>的能力。它通常与其他模式结合使用，为Agent增加一个“反思”步骤。</p>
<ul>
<li><strong>反思（Reflection）</strong>：Agent 在完成一个任务或得到一个结果后，会重新评估这个结果是否正确或达到预期。</li>
<li><strong>纠正（Correction）</strong>：如果评估结果不理想，Agent 会根据反思结果，修改其原始的思考路径或行动计划，然后再次尝试，直到达到满意的结果。</li>
</ul>
<p>这种模式能显著提升Agent在复杂问题上的表现，因为它允许Agent从错误中学习，避免重复犯错。</p>
<p>这三种模式并不是相互独立的。一个强大的Agent通常会结合使用这些思想：例如，一个Agent可能先用 <strong>Plan-and-Execute</strong> 进行任务分解，然后在每个执行步骤中，使用 <strong>ReAct</strong> 循环来调用工具，并最终用 <strong>Self-Correction</strong> 机制来验证和修正结果。</p>
<h3 id="大模型如何“用”工具？Agent、Function-Call与MCP的进化之路"><a href="#大模型如何“用”工具？Agent、Function-Call与MCP的进化之路" class="headerlink" title="大模型如何“用”工具？Agent、Function Call与MCP的进化之路"></a>大模型如何“用”工具？Agent、Function Call与MCP的进化之路</h3><p>在构建基于大语言模型（LLM）的应用时，一个核心挑战是让LLM不只停留在“聊天”，而是真正具备“行动”能力，比如联网搜索、调用API或执行代码。这就是 <strong>Agent</strong> 的核心思想：让LLM像一个智能体一样，能够根据用户的指令，自主决定是直接回答，还是调用外部工具来获取信息或完成任务。</p>
<h4 id="1-Agent-的决策过程：LLM如何知道何时调用工具？"><a href="#1-Agent-的决策过程：LLM如何知道何时调用工具？" class="headerlink" title="1. Agent 的决策过程：LLM如何知道何时调用工具？"></a>1. Agent 的决策过程：LLM如何知道何时调用工具？</h4><p>Agent 的决策机制本质上是 <strong>Prompt Engineering</strong> 的一种高级应用。开发者会设计一个精巧的 <strong>Prompt</strong>，将可用的工具列表、它们的用途和描述一并告诉LLM。</p>
<p>例如，当我们问一个 Agent：“今天北京的天气怎么样？”它的思考过程可能如下：</p>
<ol>
<li><strong>用户意图分析：</strong> 用户想知道北京的天气。</li>
<li><strong>工具匹配：</strong> 我有一个可以查询天气的工具（<code>get_weather(location)</code>）。</li>
<li><strong>决策与执行：</strong> 我需要调用这个工具，并把“北京”作为参数。</li>
</ol>
<p>这个思考过程并不神秘，而是通过精心设计的 <strong>Prompt</strong> 来引导LLM生成。LLM会根据输入的指令和工具描述，在输出中“思考”并生成一个结构化的行动指令，然后由外部程序（Agent框架）去实际执行。</p>
<h4 id="2-Function-Call-FC-：将决策能力内置到模型中"><a href="#2-Function-Call-FC-：将决策能力内置到模型中" class="headerlink" title="2. Function Call (FC)：将决策能力内置到模型中"></a>2. Function Call (FC)：将决策能力内置到模型中</h4><p><strong>Function Call (FC)</strong> 是对上述 Agent 决策机制的一种原生优化。它将“思考”和“生成调用指令”的能力直接通过模型训练内置进去。</p>
<p><strong>FC 的核心是：</strong> 模型能够根据上下文，直接以预先定义好的 <strong>JSON 格式</strong> 生成对外部工具的调用，而不是像传统 Agent 那样需要外部框架去解析LLM生成的文本。</p>
<p>这是一种巨大的进步，因为它使得工具调用更加稳定、高效，并减少了外部解析的复杂性。</p>
<p><strong>那么，为什么说 FC 存在“MxN”的问题？</strong></p>
<p>这里有一个常见的误解：很多人以为每增加一个工具，就需要重新训练模型。<strong>这是不正确的。</strong></p>
<p>FC 的“MxN”问题不在于模型本身，而在于 <strong>工具的描述格式</strong>。每个拥有 FC 能力的LLM平台（如 OpenAI, Google, Anthropic）都有自己独特的工具描述 Schema（函数签名）。一个搜索工具，为了能被不同的模型调用，开发者需要为它编写 <strong>M</strong> 份不同的描述文档。同样，一个 Agent 开发者如果想使用 <strong>N</strong> 个工具，并支持 <strong>M</strong> 个不同的LLM，就需要处理 MxN 个兼容性问题。</p>
<p>简而言之，<strong>FC 解决了“让模型知道如何调用工具”的问题，但没有解决“工具描述格式不统一”的问题。</strong></p>
<h4 id="3-MCP：通过抽象层实现真正的解耦"><a href="#3-MCP：通过抽象层实现真正的解耦" class="headerlink" title="3. MCP：通过抽象层实现真正的解耦"></a>3. MCP：通过抽象层实现真正的解耦</h4><p><strong>Multi-tool Coordinator Protocol (MCP)</strong> 正是为了解决 FC 带来的兼容性与扩展性问题而诞生的。</p>
<p><strong>MCP 的核心思想是：在模型和工具之间增加一个抽象的中间层。</strong></p>
<p>这个中间层通常由一个 <strong>MCP Server</strong> 组成，其工作流程如下：</p>
<ol>
<li><strong>工具注册：</strong> 所有外部工具都按照一套统一的 <strong>MCP 协议</strong> 接入并注册到 MCP Server。</li>
<li><strong>Agent (LLM) 接入：</strong> 所有的 Agent 只需要学习并支持这套统一的 <strong>MCP 协议</strong>。它们不再需要知道每个工具的具体描述细节，只需向 MCP Server 发送一个统一的请求，来获取可用的工具列表或执行工具调用。</li>
</ol>
<p><strong>为什么说 MCP 实现了“M+N”？</strong></p>
<ul>
<li><strong>M</strong> 个不同的模型（或 Agent）只需要对接 <strong>1</strong> 个统一的 MCP Server。</li>
<li><strong>N</strong> 个不同的工具也只需要对接 <strong>1</strong> 个统一的 MCP Server。</li>
</ul>
<p>通过这种方式，模型与工具之间不再是复杂的点对点连接，而是通过一个中心化的枢纽进行通信。这不仅解决了 FC 在不同平台间的兼容性问题，更是一种架构上的巨大优化，它让工具的管理、维护和扩展变得前所未有的简单。</p>
<p><strong>总结来说：</strong></p>
<ul>
<li><strong>Agent</strong> 是让 LLM 具备行动能力的 <strong>思想</strong>。</li>
<li><strong>Function Call</strong> 是将这种思想 <strong>内置到模型中</strong> 的一种能力。</li>
<li><strong>MCP</strong> 是在此基础上，进一步将 <strong>模型与工具解耦</strong> 的一种 <strong>架构设计</strong>。</li>
</ul>
<p>当然，MCP 还需要在调用端封装。在典型的 <strong>MCP (Multi-tool Coordinator Protocol)</strong> 实现中，会区分 <strong>AI Host (AI宿主)</strong> 和 <strong>MCP Client (MCP客户端)</strong> 这两个角色，它们通过一种清晰的协作模式来共同完成任务。</p>
<ol>
<li><p><strong>AI Host (AI宿主)</strong></p>
<ul>
<li><strong>角色：</strong> AI Host 是整个系统的核心，通常是运行大语言模型（LLM）或 Agent 框架的那部分。它负责接收用户的指令，并进行高级别的决策与推理。</li>
<li><strong>职责：</strong><ul>
<li>接收用户输入。</li>
<li>与LLM交互，进行意图分析。</li>
<li>根据LLM的输出，决定是直接生成回复还是需要调用工具。</li>
<li><strong>注意：</strong> AI Host 不直接与具体的工具交互，它只知道 MCP 协议。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>MCP Client (MCP客户端)</strong></p>
<ul>
<li><strong>角色：</strong> MCP Client 是一个独立的模块或库，作为 AI Host 与 MCP Server 之间的桥梁。它封装了所有与 MCP Server 通信的细节。</li>
<li><strong>职责：</strong><ul>
<li>将来自 AI Host 的工具调用请求，按照 <strong>MCP 协议</strong> 进行格式化，并发送给 MCP Server。</li>
<li>接收 MCP Server 返回的结果，并将其转换回 AI Host 可理解的格式。</li>
<li>管理与 MCP Server 的连接和会话。</li>
<li><strong>注意：</strong> MCP Client 也不关心具体的工具是如何实现的，它只负责协议层面的通信。</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>整个 MCP 协作过程可以分解为以下几个步骤：</p>
<ol>
<li><strong>用户请求：</strong> 用户向 AI Host 发出指令，例如：“帮我查一下旧金山的天气。”</li>
<li><strong>AI Host 意图分析：</strong> AI Host 将用户指令发送给内置的 LLM。LLM 基于其 Function Call 或 ReAct 能力，判断出需要调用一个天气查询工具。它会生成一个结构化的调用请求，比如 <code>{&quot;tool_name&quot;: &quot;weather_api&quot;, &quot;parameters&quot;: {&quot;city&quot;: &quot;旧金山&quot;}}</code>。</li>
<li><strong>AI Host 委托：</strong> AI Host 拿到 LLM 生成的调用请求后，并不会自己去执行，而是将其 <strong>委托</strong> 给 <strong>MCP Client</strong>。</li>
<li><strong>MCP Client 协议转换与发送：</strong> MCP Client 接收到这个请求，将其封装成符合 MCP 协议的格式（例如一个特定的 HTTP POST 请求或 gRPC 调用），然后发送给远端的 <strong>MCP Server</strong>。</li>
<li><strong>MCP Server 工具协调与执行：</strong> MCP Server 接收到请求后，根据 <code>tool_name</code> 找到对应的工具，将 <code>parameters</code> 传递给该工具并执行。</li>
<li><strong>结果返回：</strong> 工具执行完毕，结果返回给 MCP Server，MCP Server 再将结果通过 MCP 协议返回给 MCP Client。</li>
<li><strong>MCP Client 结果转换与回传：</strong> MCP Client 接收到 MCP Server 的响应，将其解析并转换为 AI Host 可理解的格式，然后返回给 AI Host。</li>
<li><strong>AI Host 回复生成：</strong> AI Host 拿到工具执行结果（例如：“旧金山今天多云，气温15摄氏度”），将其作为上下文的一部分再次输入给LLM，最终由LLM生成完整的自然语言回复给用户。</li>
</ol>
<p>通过这种方式，AI Host 始终保持“干净”，只关心高级别的推理和决策，而具体的工具调用和协议通信的复杂性则完全由 MCP Client 和 MCP Server 这层抽象来处理，实现了AI能力与工具生态的彻底解耦。</p>
<p>最后，通过一个图说明 FC 和 MCP 工作模式：</p>
<p><img src="/images/posts/llm/agent/fc_mcp.gif" alt="FC和MCP工作模式"></p>
<h3 id="JSON-格式化输出"><a href="#JSON-格式化输出" class="headerlink" title="JSON 格式化输出"></a>JSON 格式化输出</h3><p>在 <strong>Function Call (FC)</strong> 模式下，要保证模型稳定输出 JSON 格式，主要依赖于 <strong>模型本身的训练和微调</strong>。</p>
<h4 id="如何保证模型稳定输出-JSON？"><a href="#如何保证模型稳定输出-JSON？" class="headerlink" title="如何保证模型稳定输出 JSON？"></a>如何保证模型稳定输出 JSON？</h4><p>这并非单纯通过 Prompt Engineering 就能完美解决的问题。核心在于：</p>
<ol>
<li><strong>大规模训练：</strong> 在模型的预训练和指令微调阶段，会使用大量的包含 JSON 格式的结构化数据作为训练样本。这些样本告诉模型，当它接收到特定类型的指令（例如，要求它调用某个工具）时，应该输出一个遵循特定 JSON Schema 的结果。</li>
<li><strong>特殊的解码策略：</strong> 一些模型在解码时会采用特殊的约束，比如 <strong>JSON Schema 约束解码</strong>。这意味着，模型在生成每一个 token 时，都会检查其是否符合预先定义的 JSON 格式规则。如果生成的 token 会导致 JSON 格式无效，模型会将其“回溯”并尝试生成另一个 token，直到生成完整且正确的 JSON。这种方法极大地提高了输出的稳定性和正确性。</li>
<li><strong>Prompt 工程辅助：</strong> 尽管核心能力来自模型本身，但好的 Prompt 仍然至关重要。例如，在 Prompt 中清晰地描述工具的函数签名，并明确要求模型“请以 JSON 格式输出调用结果”，可以进一步引导模型输出期望的格式。</li>
</ol>
<p>比如这个 FC 输出的格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;get_current_weather&quot;,</span><br><span class="line">  &quot;arguments&quot;: &#123;</span><br><span class="line">    &quot;location&quot;: &quot;旧金山&quot;,</span><br><span class="line">    &quot;unit&quot;: &quot;celsius&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中的每个 key 和 value 都要非常精准的匹配到调用的工具才可以。</p>
<h4 id="MCP-是否也要求模型输出固定格式？"><a href="#MCP-是否也要求模型输出固定格式？" class="headerlink" title="MCP 是否也要求模型输出固定格式？"></a>MCP 是否也要求模型输出固定格式？</h4><p><strong>是的，但要求的是更简单、更统一的格式。</strong></p>
<p><strong>MCP</strong> 的核心理念是 <strong>解耦</strong>。它将工具的复杂性和多样性从模型端剥离，因此模型不需要了解每个工具具体的 JSON Schema。模型唯一需要知道的，是与 <strong>MCP Client</strong> 交互的 <strong>统一协议</strong>。</p>
<p>这个统一协议的格式通常非常简单，比如一个包含 <code>tool_name</code> 和 <code>parameters</code> 的 JSON 对象。模型需要做的，只是稳定输出这个简单的、所有工具都通用的 JSON 格式，然后由 <strong>MCP Client</strong> 去处理后续的协议转换和工具调用。</p>
<p>这正是 <strong>MCP</strong> 的优势所在：它降低了对模型的要求。模型不需要针对每一个新工具去学习其独特的调用格式，它只需要掌握一套通用的、简单的输出格式即可。这使得模型可以更专注于其核心的自然语言理解和意图识别，而将复杂的<br>工具协调任务交给 <strong>MCP Client</strong> 和 <strong>MCP Server</strong> 去完成。</p>
<p>下面是一个模型输出的MCP格式的调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tool_name&quot;: &quot;weather_api&quot;,</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;city&quot;: &quot;旧金山&quot;,</span><br><span class="line">    &quot;temp_unit&quot;: &quot;celsius&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个看起来比较类似，但实际上模型并不知道 weather_api 到底是什么，也不知道对于一个 city，应该传入的参数是什么（city？location？），对于温度单位，也类似。</p>
<p>FC (Function Call) 模式下，模型的难度体现在 “量” 上。<strong>模型需要记忆并理解每一个工具独特的 JSON Schema，而且要非常精确</strong>。如果你的系统有100个不同的工具，每个工具的参数都不一样，那模型就需要稳定地输出100种不同结构的 JSON。这就像让一个人记住100个完全不同的表格格式，并根据指令填写。</p>
<p>而 MCP (Multi-tool Coordinator Protocol) 模式下，模型的难度只体现在 “质” 上。它只需要学会一种 统一且简单的 JSON 格式，即 {“tool_name”: “…”, “parameters”: {…}}。无论有多少个工具，这个输出格式始终不变。这就像让一个人永远只填写一种固定格式的表格，然后把表格交给一个“总机”去处理后续的细节。</p>
<p>MCP Client 拿到的模型输出，也就是通用且简单的 JSON 格式（例如：{“tool_name”: “…”, “parameters”: {…}}），负责将其解析、封装、调用 Server、接收响应、解析响应，回传给 AI Host。</p>

    </div>

    
    
    
        
      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>AngryBirds</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://murphypei.github.io/blog/2025/07/agent-fc-mcp.html" title="Agent 几个问题思考">https://murphypei.github.io/blog/2025/07/agent-fc-mcp.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/LLM/" rel="tag"># LLM</a>
            
              <a href="/tags/agent/" rel="tag"># agent</a>
            
              <a href="/tags/rag/" rel="tag"># rag</a>
            
              <a href="/tags/mcp/" rel="tag"># mcp</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/blog/2025/07/llm-zero.html" rel="next" title="LLM 训练：ZeRO 技术详解">
                  <i class="fa fa-chevron-left"></i> LLM 训练：ZeRO 技术详解
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Agent-设计范式"><span class="nav-number">1.</span> <span class="nav-text">Agent 设计范式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-ReAct-Reasoning-and-Acting"><span class="nav-number">1.1.</span> <span class="nav-text">1. ReAct (Reasoning and Acting)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Plan-and-Execute（规划与执行）"><span class="nav-number">1.2.</span> <span class="nav-text">2. Plan-and-Execute（规划与执行）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Self-Correction（自我纠正-反思）"><span class="nav-number">1.3.</span> <span class="nav-text">3. Self-Correction（自我纠正/反思）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#大模型如何“用”工具？Agent、Function-Call与MCP的进化之路"><span class="nav-number">2.</span> <span class="nav-text">大模型如何“用”工具？Agent、Function Call与MCP的进化之路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Agent-的决策过程：LLM如何知道何时调用工具？"><span class="nav-number">2.1.</span> <span class="nav-text">1. Agent 的决策过程：LLM如何知道何时调用工具？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Function-Call-FC-：将决策能力内置到模型中"><span class="nav-number">2.2.</span> <span class="nav-text">2. Function Call (FC)：将决策能力内置到模型中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-MCP：通过抽象层实现真正的解耦"><span class="nav-number">2.3.</span> <span class="nav-text">3. MCP：通过抽象层实现真正的解耦</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSON-格式化输出"><span class="nav-number">3.</span> <span class="nav-text">JSON 格式化输出</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#如何保证模型稳定输出-JSON？"><span class="nav-number">3.1.</span> <span class="nav-text">如何保证模型稳定输出 JSON？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MCP-是否也要求模型输出固定格式？"><span class="nav-number">3.2.</span> <span class="nav-text">MCP 是否也要求模型输出固定格式？</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/angry_bird_128.ico"
      alt="AngryBirds">
  <p class="site-author-name" itemprop="name">AngryBirds</p>
  <div class="site-description" itemprop="description">虚怀若谷，大智若愚</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">182</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">474</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/murphypei" title="GitHub &rarr; https://github.com/murphypei" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:murphypei47@gmail.com" title="E-Mail &rarr; mailto:murphypei47@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.zhihu.com/people/guo-jia-66-80/activities" title="https://www.zhihu.com/people/guo-jia-66-80/activities" rel="noopener" target="_blank">知乎</a>
        </li>
      
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AngryBirds</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">647k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">17:58</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>
<script src="/js/schemes/muse.js?v=7.3.0"></script>

<script src="/js/next-boot.js?v=7.3.0"></script>



  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>





















  

  
    
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    
  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'e14928c5d4e586a1be33',
      clientSecret: 'b58488475e69824177de7fa4e52325a0de1dbdb7',
      repo: 'murphypei.github.io',
      owner: 'murphypei',
      admin: ['murphypei'],
      id: '5448633e54f05edf9be82409ea595a5f',
        language: 'zh-CN',
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/haru01.model.json"},"display":{"position":"left","width":250,"height":400},"mobile":{"show":false}});</script></body>
</html>
